/**
 * stormpath-sdk-angularjs
 * Copyright Stormpath, Inc. 2016
 * 
 * @version v1.1.1-dev-2016-12-02
 * @link https://github.com/stormpath/stormpath-sdk-angularjs
 * @license Apache-2.0
 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="stormpath"),function(a,b,c){"use strict";b.module("stormpath",["stormpath.CONFIG","stormpath.utils","stormpath.auth","stormpath.userService","stormpath.viewModelService","stormpath.socialLogin","stormpath.oauth"]).factory("StormpathAgentInterceptor",["$isCurrentDomain","$spHeaders",function(a,c){function d(){}return d.prototype.request=function(d){return a(d.url)&&(d.headers=b.extend(d.headers,c)),d},new d}]).config(["$httpProvider",function(a){a.interceptors.push("StormpathAgentInterceptor")}]).provider("$stormpath",[function(){this.$get=["$user","$injector","STORMPATH_CONFIG","$rootScope","$location",function(a,b,d,e,f){function g(){var a=new m;return this.encodeUrlForm=a.encode.bind(a),b.has("$state")&&(n=b.get("$state")),b.has("$route")&&(o=b.get("$route")),this}function h(a,b){e.$broadcast(d.STATE_CHANGE_UNAUTHENTICATED,a,b)}function i(a,b){e.$broadcast(d.STATE_CHANGE_UNAUTHORIZED,a,b)}function j(b,c){var d=b;if(d&&d.authorize&&d.authorize.group)return a.currentUser.inGroup(d.authorize.group);if(c){var e=c.filter(function(b){return a.currentUser.inGroup(b)});return e.length>0}return console.error("Unknown authorize configuration for spStateConfig",b),!1}function k(a){e.$broadcast(d.ROUTE_CHANGE_UNAUTHENTICATED,a)}function l(a){e.$broadcast(d.ROUTE_CHANGE_UNAUTHORIZED,a)}function m(){return this.delimiter="&",this.arrayPrefixGenerators={brackets:function(a){return a+"[]"},indices:function(a,b){return a+"["+b+"]"},repeat:function(a){return a}},this}var n,o;return g.prototype.stateChangeInterceptor=function(b){e.$on("$stateChangeStart",function(d,e,f){var g=e.sp||{},k=e.data&&e.data.authorities?e.data.authorities:c;(g.authenticate||g.authorize||k&&k.length)&&!a.currentUser?(d.preventDefault(),a.get().then(function(){g.authorize||k&&k.length?j(g,k)?n.go(e.name,f):i(e,f):n.go(e.name,f)},function(){h(e,f)})):g.waitForUser&&null===a.currentUser?(d.preventDefault(),a.get()["finally"](function(){n.go(e.name,f)})):a.currentUser&&(g.authorize||k&&k.length)?j(g,k)||(d.preventDefault(),i(e,f)):e.name===b.loginState&&a.currentUser!==!1&&(d.preventDefault(),a.get()["finally"](function(){a.currentUser&&a.currentUser.href?n.go(b.defaultPostLoginState):n.go(e.name,f)}))})},g.prototype.routeChangeInterceptor=function(b){function c(a){setTimeout(function(){a.$$route.originalPath===f.path()?o.reload():f.path(a)})}e.$on("$routeChangeStart",function(d,e){if(e.$$route){var f=e.$$route.sp||{};!f.authenticate&&!f.authorize||a.currentUser?f.waitForUser&&null===a.currentUser?(d.preventDefault(),a.get()["finally"](function(){c(e)})):a.currentUser&&f.authorize?j(f)||(d.preventDefault(),l(e)):e.$$route.originalPath===b.loginRoute&&a.currentUser&&a.currentUser.href&&(d.preventDefault(),c(b.defaultPostLoginRoute)):(d.preventDefault(),a.get().then(function(){f.authorize?j(f)?c(e):i(e):c(e)},function(){k(e)}))}})},g.prototype.uiRouter=function(a){var b=this;a="object"==typeof a?a:{},this.stateChangeInterceptor(a),a.loginState&&(b.unauthenticatedWather=e.$on(d.STATE_CHANGE_UNAUTHENTICATED,function(c,d,e){b.postLogin={toState:d,toParams:e},n.go(a.loginState)})),e.$on(d.AUTHENTICATION_SUCCESS_EVENT_NAME,function(){b.postLogin&&a.autoRedirect!==!1?n.go(b.postLogin.toState,b.postLogin.toParams).then(function(){b.postLogin=null}):a.defaultPostLoginState&&n.go(a.defaultPostLoginState)}),a.forbiddenState&&(b.forbiddenWatcher=e.$on(d.STATE_CHANGE_UNAUTHORIZED,function(){n.go(a.forbiddenState)}))},g.prototype.ngRouter=function(a){var b=this;a="object"==typeof a?a:{},this.routeChangeInterceptor(a),a.loginRoute&&(this.unauthenticatedWather=e.$on(d.ROUTE_CHANGE_UNAUTHENTICATED,function(c,d){b.postLogin={toRoute:d},f.path(a.loginRoute)})),e.$on(d.AUTHENTICATION_SUCCESS_EVENT_NAME,function(){b.postLogin&&a.autoRedirect!==!1?(f.path(b.postLogin.toRoute),b.postLogin=null):a.defaultPostLoginRoute&&f.path(a.defaultPostLoginRoute)}),a.forbiddenRoute&&(this.forbiddenWatcher=e.$on(d.ROUTE_CHANGE_UNAUTHORIZED,function(){f.path(a.forbiddenRoute)}))},g.prototype.regexAttrParser=function(a){var b;return b=a instanceof RegExp?a:a&&/^\/.+\/[gim]?$/.test(a)?new RegExp(a.split("/")[1],a.split("/")[2]):a},m.prototype.stringify=function(a,b,c){if(a instanceof Date?a=a.toISOString():null===a&&(a=""),"string"==typeof a||"number"==typeof a||"boolean"==typeof a)return[encodeURIComponent(b)+"="+encodeURIComponent(a)];var d=[];if("undefined"==typeof a)return d;for(var e=Object.keys(a),f=0,g=e.length;f<g;++f){var h=e[f];d=Array.isArray(a)?d.concat(this.stringify(a[h],c(b,h),c)):d.concat(this.stringify(a[h],b+"["+h+"]",c))}return d},m.prototype.encode=function(a,b){b=b||{};var c="undefined"==typeof b.delimiter?this.delimiter:b.delimiter,d=[];if("object"!=typeof a||null===a)return"";var e;e=b.arrayFormat in this.arrayPrefixGenerators?b.arrayFormat:"indices"in b?b.indices?"indices":"repeat":"indices";for(var f=this.arrayPrefixGenerators[e],g=Object.keys(a),h=0,i=g.length;h<i;++h){var j=g[h];d=d.concat(this.stringify(a[j],j,f))}return d.join(c)},new g}]}]).run(["$rootScope","$user","STORMPATH_CONFIG",function(a,b,c){a.user=b.currentUser||null,b.get()["finally"](function(){a.user=b.currentUser}),a.$on(c.GET_USER_EVENT,function(){a.user=b.currentUser}),a.$on(c.SESSION_END_EVENT,function(){a.user=b.currentUser}),a.$on(c.SESSION_END_ERROR_EVENT,function(a,b){console.error("Logout error",b)}),a.$on(c.UNAUTHENTICATED_EVENT,function(a,b){console.error("UNAUTHENTICATED_EVENT")})}]).directive("ifUser",["$user","$rootScope",function(a,b){return{link:function(a,c){b.$watch("user",function(a){a&&a.href?c.removeClass("ng-hide"):c.addClass("ng-hide")})}}}]).directive("ifNotUser",["$user","$rootScope",function(a,b){return{link:function(a,c){b.$watch("user",function(a){a&&a.href?c.addClass("ng-hide"):c.removeClass("ng-hide")})}}}]).directive("ifUserInGroup",["$user","$rootScope","$parse","$stormpath",function(a,b,c,d){return{link:function(e,f,g){function h(){var b=a.currentUser;b&&b.groupTest(i||j)?f.removeClass("ng-hide"):f.addClass("ng-hide")}var i,j=g.ifUserInGroup;j&&(e.$watch(c(j),function(a){i=d.regexAttrParser(a),h()}),b.$watch("user",function(){h()}))}}}]).directive("ifUserNotInGroup",["$user","$rootScope","$parse","$stormpath",function(a,b,c,d){return{link:function(e,f,g){function h(){var b=a.currentUser;b&&b.groupTest(i||j)?f.addClass("ng-hide"):f.removeClass("ng-hide")}var i,j=g.ifUserNotInGroup;j&&(e.$watch(c(j),function(a){i=d.regexAttrParser(a),h()}),b.$watch("user",function(){h()}))}}}]).directive("whileResolvingUser",["$user","$rootScope",function(a,b){return{link:function(c,d){b.$watch("user",function(){a.currentUser||a.currentUser===!1?d.addClass("ng-hide"):d.removeClass("ng-hide")})}}}]).directive("ifUserStateKnown",["$user","$rootScope",function(a,b){return{link:function(c,d){b.$watch("user",function(){a.currentUser||a.currentUser===!1?d.removeClass("ng-hide"):d.addClass("ng-hide")})}}}]).directive("ifUserStateUnknown",["$user","$rootScope",function(a,b){return{link:function(c,d){b.$watch("user",function(){null===a.currentUser?d.removeClass("ng-hide"):d.addClass("ng-hide")})}}}]).directive("spLogout",["$auth",function(a){return{link:function(b,c){c.on("click",function(){a.endSession()})}}}]),b.module("stormpath.auth",["stormpath.CONFIG","stormpath.oauth","stormpath.utils"]).config(["$injector","STORMPATH_CONFIG",function(a,c){var d={$get:["$http","$user","$rootScope","$spFormEncoder","$q","$spErrorTransformer","$isCurrentDomain","StormpathOAuth",function(a,d,e,f,g,h,i,j){function k(){return this}function l(){e.$broadcast(c.SESSION_END_EVENT)}function m(a){e.$broadcast(c.AUTHENTICATION_SUCCESS_EVENT_NAME,a)}function n(a){e.$broadcast(c.AUTHENTICATION_FAILURE_EVENT_NAME,a)}return k.prototype.authenticate=function(e){function k(a){d.get(!0).then(function(){m(a)})}function l(a){return n(a),g.reject(h.transformError(a))}var o,p={Accept:"application/json"},q=c.getUrl("AUTHENTICATION_ENDPOINT");if(i(q))o=a(f.formPost({url:q,method:"POST",headers:p,withCredentials:!0,data:e}));else{var r=b.extend({},e);r.login&&(r.username=r.login,delete r.login),o=j.authenticate(r,p)}return o.then(k,l)},k.prototype.endSession=function(){var b,d=c.getUrl("DESTROY_SESSION_ENDPOINT");return b=i(d)?a.post(d,null,{headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}):j.revoke(),b["finally"](function(){l()})["catch"](function(a){e.$broadcast(c.SESSION_END_ERROR_EVENT,a)}),b},new k}]};a.get("$provide").provider(c.AUTH_SERVICE_NAME,d)}]),b.module("stormpath.CONFIG",[]).constant("STORMPATH_CONFIG",function(){var a={AUTHENTICATION_SUCCESS_EVENT_NAME:"$authenticated",AUTHENTICATION_FAILURE_EVENT_NAME:"$authenticationFailure",AUTH_SERVICE_NAME:"$auth",SOCIAL_LOGIN_SERVICE_NAME:"$socialLogin",SOCIAL_LOGIN_RESPONSE_TYPE:"stormpath_token",SOCIAL_LOGIN_OPTIONS:{google:{},facebook:{},twitter:{},linkedIn:{}},SOCIAL_LOGIN_REDIRECT_URI:"",SOCIAL_LOGIN_AUTHORIZE_URI:"/authorize",AUTHENTICATION_ENDPOINT:"/login",CURRENT_USER_URI:"/me",DESTROY_SESSION_ENDPOINT:"/logout",EMAIL_VERIFICATION_ENDPOINT:"/verify",ENDPOINT_PREFIX:"",GET_USER_EVENT:"$currentUser",NOT_LOGGED_IN_EVENT:"$notLoggedin",FORGOT_PASSWORD_ENDPOINT:"/forgot",CHANGE_PASSWORD_ENDPOINT:"/change",SESSION_END_EVENT:"$sessionEnd",SESSION_END_ERROR_EVENT:"$sessionEndError",STATE_CHANGE_UNAUTHENTICATED:"$stateChangeUnauthenticated",STATE_CHANGE_UNAUTHORIZED:"$stateChangeUnauthorized",ROUTE_CHANGE_UNAUTHENTICATED:"$routeChangeUnauthenticated",ROUTE_CHANGE_UNAUTHORIZED:"$routeChangeUnauthorized",OAUTH_REQUEST_ERROR:"$oAuthRequestError",OAUTH_AUTHENTICATION_ENDPOINT:"/oauth/token",OAUTH_REVOKE_ENDPOINT:"/oauth/revoke",OAUTH_TOKEN_STORAGE_NAME:"stormpath:token",REGISTER_URI:"/register",REGISTERED_EVENT_NAME:"$registered",OAUTH_DEFAULT_TOKEN_STORE_TYPE:"localStorage"};return a.getUrl=function(a){return this.ENDPOINT_PREFIX+this[a]},a.getSocialLoginConfiguration=function(a){var b=a?a.toLowerCase():"";return this.SOCIAL_LOGIN_OPTIONS[b]||{}},a}()),b.module("stormpath").controller("SpEmailVerificationCtrl",["$scope","$location","$user",function(a,b,c){a.showVerificationError=!1,a.verifying=!1,a.reVerificationSent=!1,a.needsReVerification=!1,a.resendFailed=!1,a.formModel={username:""},b.search().sptoken?(a.verifying=!0,c.verify(b.search().sptoken).then(function(){a.verified=!0})["catch"](function(){a.needsReVerification=!0,a.showVerificationError=!0})["finally"](function(){a.verifying=!1})):(a.needsReVerification=!0,a.showVerificationError=!0),a.submit=function(){a.posting=!0,a.resendFailed=!1,a.showVerificationError=!1,c.resendVerificationEmail({login:a.formModel.username}).then(function(){a.reVerificationSent=!0})["catch"](function(){a.resendFailed=!0})["finally"](function(){a.posting=!1})}}]).directive("spEmailVerification",function(){return{templateUrl:function(a,b){return b.templateUrl||"spEmailVerification.tpl.html"},controller:"SpEmailVerificationCtrl"}}),b.module("stormpath").controller("SpLoginFormCtrl",["$scope","$auth","$viewModel",function(a,b,c){a.viewModel=null,c.getLoginModel().then(function(b){var c=["facebook","google"];b.accountStores=b.accountStores.filter(function(a){var b=a.provider.providerId;return c.indexOf(b)>-1}),a.viewModel=b})["catch"](function(a){throw new Error("Could not load login view model from back-end: "+a.message)}),a.formModel={},a.posting=!1,a.submit=function(){a.posting=!0,a.error=null,b.authenticate(a.formModel)["catch"](function(b){a.posting=!1,a.error=b.message})}}]).directive("spLoginForm",function(){return{templateUrl:function(a,b){return b.templateUrl||"spLoginForm.tpl.html"},controller:"SpLoginFormCtrl"}}),b.module("stormpath.oauth",["stormpath.CONFIG","stormpath.utils","storpath.tokenStore"]).provider("StormpathOAuthToken",["STORMPATH_CONFIG",function(a){var b=this;this._tokenStoreType=a.OAUTH_DEFAULT_TOKEN_STORE_TYPE,this.setTokenStoreType=function(a){this._tokenStoreType=a},this.$get=function(c,d,e,f){function g(){this.tokenStore=e.getTokenStore(b._tokenStoreType)}return g.prototype.setTokenStoreType=function(a){this.tokenStore=e.getTokenStore(a)},g.prototype.setToken=function(b){var c=d(b);return c.exp=new Date((new Date).setMilliseconds(0)+1e3*(b.expires_in-1)),this.tokenStore.put(a.OAUTH_TOKEN_STORAGE_NAME,c)},g.prototype.getToken=function(){return this.tokenStore.get(a.OAUTH_TOKEN_STORAGE_NAME)},g.prototype.removeToken=function(){return this.tokenStore.remove(a.OAUTH_TOKEN_STORAGE_NAME)},g.prototype.getAccessToken=function(){return this.getToken().then(function(a){return a?a.accessToken:c.reject()})},g.prototype.getRefreshToken=function(){return this.getToken().then(function(a){return a?a.refreshToken:c.reject()})},g.prototype.getTokenType=function(){return this.getToken().then(function(a){return a?a.tokenType:c.reject()})},g.prototype.getAuthorizationHeader=function(){var a=this;return this.getToken().then(function(b){var d=b&&b.tokenType,e=b&&b.accessToken;if(!d||!e)return c.reject();if(new Date>=new Date(b.exp)){var g=f.get("StormpathOAuth");return g.refresh().then(function(){return a.getAuthorizationHeader()})}var h=d.charAt(0).toUpperCase()+d.substr(1);return h+" "+e})},new g},this.$get.$inject=["$q","$normalizeObjectKeys","TokenStoreManager","$injector"]}]).provider("StormpathOAuth",["STORMPATH_CONFIG",function(a){var c;this.$get=function(d,e,f){function g(){return this.refreshPromise=null,this}return g.prototype.authenticate=function(c,g){var h=b.extend({grant_type:"password"},c),i=b.extend({Accept:"application/json"},g);return d(e.formPost({url:a.getUrl("OAUTH_AUTHENTICATION_ENDPOINT"),method:"POST",headers:i,data:h})).then(function(a){return f.setToken(a.data),a})},g.prototype.revoke=function(){return f.getToken().then(function(b){var c={token:b.refreshToken||b.accessToken,token_type_hint:b.refreshToken?"refresh_token":"access_token"};return d(e.formPost({url:a.getUrl("OAUTH_REVOKE_ENDPOINT"),method:"POST",data:c}))["finally"](function(a){return f.removeToken(),a})})},g.prototype.refresh=function(c,g){var h=this;return h.refreshPromise?h.refreshPromise:h.refreshPromise=f.getRefreshToken().then(function(i){var j=b.extend({grant_type:"refresh_token",refresh_token:i},c),k=b.extend({Accept:"application/json"},g);return d(e.formPost({url:a.getUrl("OAUTH_AUTHENTICATION_ENDPOINT"),method:"POST",headers:k,data:j})).then(function(a){return f.setToken(a.data),a})["catch"](function(a){return f.removeToken(),a})["finally"](function(){h.refreshPromise=null})})},c||(c=new g),c},this.$get.$inject=["$http","$spFormEncoder","StormpathOAuthToken"]}]).provider("$spOAuthBlacklist",[function(){var a=["/oauth/token$","/oauth/revoke$","/login$","/register$"];this.addUrl=function(c){b.isString(c)&&a.push(c)},this.$get=function(){return{isBlacklisted:function(b){b=b||"";var c=!1;return a.forEach(function(a){c||(c=new RegExp(a).test(b))}),c}}},this.$get.$inject=[]}]).factory("StormpathOAuthInterceptor",["$isCurrentDomain","$spOAuthBlacklist","$rootScope","$q","$injector","StormpathOAuthToken","STORMPATH_CONFIG",function(a,b,c,d,e,f,g){function h(){}return h.prototype.request=function(c){return a(c.url)||b.isBlacklisted(c.url)?c:(c.headers=c.headers||{},f.getAuthorizationHeader().then(function(a){return a&&(c.headers.Authorization=a),c})["catch"](function(){return c}))},new h}]).config(["$httpProvider",function(a){a.interceptors.push("StormpathOAuthInterceptor")}]),b.module("stormpath").controller("SpPasswordResetRequestCtrl",["$scope","$user",function(a,b){a.sent=!1,a.posting=!1,a.formModel={username:""},a.error=null,a.submit=function(){a.posting=!0,a.error=null,b.passwordResetRequest({email:a.formModel.email}).then(function(){a.sent=!0})["catch"](function(b){a.error=b.message})["finally"](function(){a.posting=!1})}}]).controller("SpPasswordResetCtrl",["$scope","$location","$user",function(a,b,c){var d=b.search().sptoken;a.showVerificationError=!1,a.verifying=!1,a.verified=!1,a.posting=!1,a.reset=!1,a.error=null,a.resendFailed=!1,a.formModel={password:"",confirmPassword:""},"string"==typeof d?(a.verifying=!0,c.verifyPasswordResetToken(d).then(function(){a.verified=!0})["catch"](function(){a.showVerificationError=!0})["finally"](function(){a.verifying=!1})):a.showVerificationError=!0,a.submit=function(){return a.formModel.password!==a.formModel.confirmPassword?void(a.error="Passwords do not match"):(a.posting=!0,a.error=null,a.showVerificationError=!1,void c.resetPassword(d,{password:a.formModel.password}).then(function(){a.reset=!0})["catch"](function(b){a.error=b.message})["finally"](function(){a.posting=!1}))}}]).directive("spPasswordResetRequestForm",function(){return{templateUrl:function(a,b){return b.templateUrl||"spPasswordResetRequestForm.tpl.html"},controller:"SpPasswordResetRequestCtrl"}}).directive("spPasswordResetForm",function(){return{templateUrl:function(a,b){return b.templateUrl||"spPasswordResetForm.tpl.html"},controller:"SpPasswordResetCtrl"}}),b.module("stormpath").controller("SpRegistrationFormCtrl",["$scope","$user","$auth","$location","$viewModel","$injector",function(a,b,c,d,e,f){a.formModel="object"==typeof a.formModel?a.formModel:{},a.created=!1,a.enabled=!1,a.creating=!1,a.authenticating=!1,a.viewModel=null,e.getRegisterModel().then(function(b){var c=["facebook","google"];b.accountStores=b.accountStores.filter(function(a){var b=a.provider.providerId;return c.indexOf(b)>-1}),a.viewModel=b})["catch"](function(a){throw new Error("Could not load login view model from back-end: "+a.message)}),a.submit=function(){a.creating=!0,a.error=null,b.create(a.formModel).then(function(b){a.created=!0,a.enabled="ENABLED"===b.status,a.enabled&&a.autoLogin?(a.authenticating=!0,c.authenticate({username:a.formModel.email,password:a.formModel.password}).then(function(){var b=f.has("$state")?f.get("$state"):null;a.postLoginState&&b?b.go(a.postLoginState):a.postLoginPath&&d.path(a.postLoginPath)})["catch"](function(b){a.error=b.message})["finally"](function(){a.authenticating=!1,a.creating=!1})):a.creating=!1})["catch"](function(b){a.creating=!1,a.error=b.message})}}]).directive("spRegistrationForm",function(){return{templateUrl:function(a,b){return b.templateUrl||"spRegistrationForm.tpl.html"},controller:"SpRegistrationFormCtrl",link:function(a,b,c){a.autoLogin="true"===c.autoLogin,a.postLoginPath=c.postLoginPath||"",a.postLoginState=c.postLoginState||""}}}),function(){function a(a,b,c,d,e){this.providersPromise=null,this.STORMPATH_CONFIG=a,this.$encodeQueryParams=b,this.$getLocalUrl=c,this.$http=d,this.$window=e}a.prototype.authorize=function(a,c){var d=b.extend({response_type:this.STORMPATH_CONFIG.SOCIAL_LOGIN_RESPONSE_TYPE,account_store_href:a,redirect_uri:this.$getLocalUrl(this.STORMPATH_CONFIG.SOCIAL_LOGIN_REDIRECT_URI)},c),e=this.$encodeQueryParams(d),f=this.STORMPATH_CONFIG.getUrl("SOCIAL_LOGIN_AUTHORIZE_URI")+e;this.$window.location=f},b.module("stormpath.socialLogin",["stormpath.CONFIG","stormpath.utils"]).config(["$injector","STORMPATH_CONFIG",function(b,c){var d=["$encodeQueryParams","$http","$window","$getLocalUrl",function(b,d,e,f){return new a(c,b,f,d,e)}];b.get("$provide").factory(c.SOCIAL_LOGIN_SERVICE_NAME,d)}]).directive("spSocialLogin",["$viewModel","$auth","$http","$injector","STORMPATH_CONFIG",function(a,c,d,e,f){return{link:function(a,c,d){var g=d.spSocialLogin,h=["href","providerId","clientId"],i=e.get(f.SOCIAL_LOGIN_SERVICE_NAME);a.providerName=d.spName,c.bind("click",function(){var c=a.$eval(d.spOptions),e={};b.forEach(c,function(a,b){a&&h.indexOf(b)!==-1&&(e[b]=a)}),e=b.extend(e,this.STORMPATH_CONFIG.getSocialLoginConfiguration(a.providerName)),i.authorize(g,e)})}}}]).factory("$processSocialAuthToken",["STORMPATH_CONFIG","$parseUrl","$window","$injector","$q","$rootScope",function(a,b,c,d,e,f){return function(){var g=b(c.location.href);if(g.search.jwtResponse){var h=d.get(a.AUTH_SERVICE_NAME);return h.authenticate({grant_type:"stormpath_token",token:g.search.jwtResponse}).then(function(){c.location.search="",f.$broadcast(a.AUTHENTICATION_SUCCESS_EVENT_NAME)})["catch"](function(b){throw f.$broadcast(a.AUTHENTICATION_FAILURE_EVENT_NAME),b})}return e.resolve()}}])}(),b.module("storpath.tokenStore",["stormpath.CONFIG"]).provider("TokenStoreManager",function(){var a={};this.$get=function(){return{registerTokenStore:function(c,d){var e=["get","put","remove"],f=d&&e.reduce(function(a,c){return a&&b.isFunction(d[c])},!0);if(!f)throw new Error("Invalid token store. `get`, `put` and `remove` methods must be implemented");a[c]=d},getTokenStore:function(c){if(b.isUndefined(a[c]))throw new Error("Unrecognised token store: "+c);return a[c]}}}}).factory("LocalStorageTokenStore",["$q",function(a){function d(){this._checkAvailability()}return d.prototype._checkAvailability=function(){if(typeof localStorage===c)this.hasLocalStorage=!1;else try{localStorage.setItem("sp:feature_test","test"),"test"===localStorage.getItem("sp:feature_test")?(localStorage.removeItem("sp:feature_test"),this.hasLocalStorage=!0):this.hasLocalStorage=!1}catch(a){this.hasLocalStorage=!1}},d.prototype._notImplementedError=function(){return a.reject({error:{message:"Local storage not supported in this environment"}})},d.prototype.put=function(b,c){if(!this.hasLocalStorage)return this._notImplementedError();var d;try{d=JSON.stringify(c)}catch(e){return a.reject(e)}return localStorage.setItem(b,d),a.resolve()},d.prototype.get=function(c){if(!this.hasLocalStorage)return this._notImplementedError();var d=localStorage.getItem(c);if(b.isDefined(d))try{return a.resolve(JSON.parse(d))}catch(e){return a.reject(e)}return a.reject(new Error("Token not found"))},d.prototype.remove=function(b){return this.hasLocalStorage?(localStorage.removeItem(b),a.resolve()):this._notImplementedError()},new d}]).run(["TokenStoreManager","LocalStorageTokenStore",function(a,b){a.registerTokenStore("localStorage",b)}]),b.module("stormpath.userService",["stormpath.CONFIG","stormpath.utils","stormpath.socialLogin"]).provider("$user",[function(){function a(a){var b=this;Object.keys(a).map(function(c){b[c]=a[c]})}a.prototype.inGroup=function(a){return this.groups.items.filter(function(b){return b.name===a}).length>0},a.prototype.matchesGroupExpression=function(a){return this.groups.items.filter(function(b){return a.test(b.name)}).length>0},a.prototype.groupTest=function(a){return!!(a instanceof RegExp&&this.matchesGroupExpression(a))||!!this.inGroup(a)},this.$get=["$q","$http","STORMPATH_CONFIG","$rootScope","$spFormEncoder","$spErrorTransformer","$processSocialAuthToken",function(b,c,d,e,f,g,h){function i(){return this.cachedUserOp=null,this.currentUser=null,this}function j(a){e.$broadcast(d.REGISTERED_EVENT_NAME,a)}function k(a){e.$broadcast(d.GET_USER_EVENT,a)}function l(){e.$broadcast(d.NOT_LOGGED_IN_EVENT)}i.prototype.create=function(a){return c({url:d.getUrl("REGISTER_URI"),method:"POST",data:a}).then(function(a){var c=a.data.account||a.data;return j(c),b.resolve(c)},function(a){return b.reject(g.transformError(a))})},i.prototype.get=function(e){var f=b.defer(),g=this;if(g.cachedUserOp)return g.cachedUserOp.promise;if(null!==g.currentUser&&g.currentUser!==!1&&e!==!0)return f.resolve(g.currentUser),f.promise;g.cachedUserOp=f;var i=g.currentUser?b.resolve():h();return i.then(function(){return c.get(d.getUrl("CURRENT_USER_URI")).then(function(b){g.cachedUserOp=null,g.currentUser=new a(b.data.account||b.data),k(g.currentUser),f.resolve(g.currentUser)},function(a){g.currentUser=!1,401===a.status&&l(),g.cachedUserOp=null,f.reject(a)}),f.promise})},i.prototype.resendVerificationEmail=function(a){return c({method:"POST",url:d.getUrl("EMAIL_VERIFICATION_ENDPOINT"),data:a})},i.prototype.verify=function(a){return c({url:d.getUrl("EMAIL_VERIFICATION_ENDPOINT")+"?sptoken="+a})},i.prototype.verifyPasswordResetToken=function(a){return c({url:d.getUrl("CHANGE_PASSWORD_ENDPOINT")+"?sptoken="+a})},i.prototype.passwordResetRequest=function(a){return c({method:"POST",url:d.getUrl("FORGOT_PASSWORD_ENDPOINT"),data:a})["catch"](function(a){return b.reject(g.transformError(a))})},i.prototype.resetPassword=function(a,e){return e.sptoken=a,c({method:"POST",url:d.getUrl("CHANGE_PASSWORD_ENDPOINT"),data:e})["catch"](function(a){return b.reject(g.transformError(a))})};var m=new i;return e.$on(d.SESSION_END_EVENT,function(){m.currentUser=!1}),m}]}]),b.module("stormpath.utils",["stormpath.CONFIG"]).factory("$isCurrentDomain",["$window",function(a){return function(b){var c=a.document.createElement("a");return c.href=b,a.location.host===c.host}}]).constant("$spHeaders",{"X-Stormpath-Agent":"stormpath-sdk-angularjs/1.1.1 angularjs/"+b.version.full}).provider("$spErrorTransformer",[function(){this.$get=[function(){function a(){}return a.prototype.transformError=function(a){var b=null;a.data&&(b=a.data.message||a.data.error),b||(b="An error occured when communicating with the server.");var c=new Error(b);return c.httpResponse=a,c.statusCode=a.status,c},new a}]}]).provider("$spFormEncoder",[function(){this.$get=[function(){function a(){var a=new b;return this.encodeUrlForm=a.encode.bind(a),this}function b(){return this.delimiter="&",this.arrayPrefixGenerators={brackets:function(a){return a+"[]"},indices:function(a,b){return a+"["+b+"]"},repeat:function(a){return a}},this}return a.prototype.formPost=function(a){var b=a.headers?a.headers:a.headers={};return b["Content-Type"]="application/x-www-form-urlencoded",a.data=this.encodeUrlForm(a.data),a},b.prototype.stringify=function(a,b,c){if(a instanceof Date?a=a.toISOString():null===a&&(a=""),"string"==typeof a||"number"==typeof a||"boolean"==typeof a)return[encodeURIComponent(b)+"="+encodeURIComponent(a)];var d=[];if("undefined"==typeof a)return d;for(var e=Object.keys(a),f=0,g=e.length;f<g;++f){var h=e[f];d=Array.isArray(a)?d.concat(this.stringify(a[h],c(b,h),c)):d.concat(this.stringify(a[h],b+"["+h+"]",c))}return d},b.prototype.encode=function(a,b){b=b||{};var c="undefined"==typeof b.delimiter?this.delimiter:b.delimiter,d=[];if("object"!=typeof a||null===a)return"";var e;e=b.arrayFormat in this.arrayPrefixGenerators?b.arrayFormat:"indices"in b?b.indices?"indices":"repeat":"indices";for(var f=this.arrayPrefixGenerators[e],g=Object.keys(a),h=0,i=g.length;h<i;++h){var j=g[h];d=d.concat(this.stringify(a[j],j,f))}return d.join(c)},new a}]}]).factory("$normalizeObjectKeys",function(){return function(a){var b={};return Object.keys(a).forEach(function(c){if(a.hasOwnProperty(c)){var d=c.replace(/_([A-Za-z])/g,function(a,b){return b.toUpperCase()});b[d]=a[c]}}),b}}).factory("$encodeQueryParams",function(){return function(a){if(!b.isObject(a))return"";var c=Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&");return c?"?"+c:c}}).factory("$decodeQueryParams",function(){return function(a){if(!b.isString(a)||0===a.length)return{};var c={};return a.substr(1).split("&").forEach(function(a){var b=a.split("=");c[decodeURIComponent(b[0])]=decodeURIComponent(b[1])}),c}}).factory("$parseUrl",["$decodeQueryParams",function(a){return function(b){var c=document.createElement("a");return c.href=b,{protocol:c.protocol,hash:c.hash,host:c.hostname,port:c.port,pathname:c.pathname,query:c.search,search:a(c.search)}}}]).factory("$getLocalUrl",["$location","$parseUrl",function(a,b){return function(c){if(c&&"/"!==c.charAt(0)){var d=b(c);c=d.pathname+d.query+d.hash}return a.protocol()+"://"+a.host()+(a.port()?":"+a.port():"")+c}}]),function(){function a(a,b){this.$http=a,this.STORMPATH_CONFIG=b}a.prototype.getLoginModel=function(){return this.$http.get(this.STORMPATH_CONFIG.getUrl("AUTHENTICATION_ENDPOINT"),{headers:{Accept:"application/json"}}).then(function(a){return a.data})},a.prototype.getRegisterModel=function(){return this.$http.get(this.STORMPATH_CONFIG.getUrl("REGISTER_URI"),{headers:{Accept:"application/json"}}).then(function(a){return a.data})},b.module("stormpath.viewModelService",["stormpath.utils"]).provider("$viewModel",function(){this.$get=["$http","STORMPATH_CONFIG",function(b,c){return new a(b,c)}]})}()}(window,window.angular);